<div
  class="modal fade"
  id="requestDetailModal"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-calendar-event me-2"></i>
          <span id="modalTitle">Request Details</span>
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <div class="modal-body">
        <!-- Request Information -->
          <!-- Email Status (always shown) -->
          <div class="mb-4">
            <h6>
              <i class="bi bi-envelope text-warning me-2"></i>Email Status
            </h6>
            <div class="card bg-light">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <span id="emailStatusIcon" class="fs-4 me-3"></span>
                  <div>
                    <strong id="emailStatusText"></strong>
                    <div
                      id="emailStatusDetails"
                      class="text-muted small mt-1"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Custom Message (only if exists) -->
          <div id="messageSection" class="mb-4" style="display: none">
            <h6>
              <i class="bi bi-chat-text text-info me-2"></i>Custom Message
            </h6>
            <div class="card bg-light">
              <div class="card-body">
                <p id="requestMessage" class="mb-0"></p>
              </div>
            </div>
          </div>

          <!-- Request Dates with Inline Status Buttons -->
          <div class="mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6>
                <i class="bi bi-calendar-check text-success me-2"></i>Request
                Dates
              </h6>

              <!-- Bulk Action Buttons (only show if email sent and has multiple dates) -->
              <div id="bulkActions" style="display: none">
                <small class="text-muted me-2">Bulk Actions:</small>
                <div class="btn-group btn-group-sm" role="group">
                  <button
                    type="button"
                    class="btn btn-outline-danger"
                    data-action="bulkUpdateStatus" data-status="DENIED"
                    title="Deny All"
                  >
                    <i class="bi bi-x-circle"></i> All
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-warning"
                    data-action="bulkUpdateStatus" data-status="PENDING"
                    title="Reset All to Pending"
                  >
                    <i class="bi bi-hourglass"></i> All
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-success"
                    data-action="bulkUpdateStatus" data-status="APPROVED"
                    title="Approve All"
                  >
                    <i class="bi bi-check-circle"></i> All
                  </button>
                </div>
              </div>
            </div>

            <!-- Dates List -->
            <div id="requestDatesList" class="border rounded p-3 bg-light">
              <!-- Dates will be populated here by JavaScript -->
            </div>
          </div>

          <!-- Email Content Section (Manual Mode Only) -->
          <!-- Email Content Section (Manual Mode Only) -->
          <div id="emailContentSection" style="display: none">
            <hr class="my-4" />
            <h6>
              <i class="bi bi-envelope-plus me-2"></i>
              Email Content to Copy
            </h6>

            <!-- Loading State -->
            <div
              id="emailContentLoading"
              class="text-center py-3"
              style="display: none"
            >
              <div class="spinner-border spinner-border-sm" role="status"></div>
              <span class="ms-2">Generating email content...</span>
            </div>

            <!-- Email Content -->
            <div id="emailContentDisplay" class="card bg-light">
              <div class="card-body">
                <div class="mb-2">
                  <label class="fw-bold small">To:</label>
                  <div class="input-group input-group-sm">
                    <input
                      type="text"
                      class="form-control"
                      readonly
                      id="emailTo"
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      data-copy-target="emailTo"
                      title="Copy email address"
                    >
                      <i class="bi bi-clipboard"></i>
                    </button>
                  </div>
                </div>

                <div class="mb-2">
                  <label class="fw-bold small">Subject:</label>
                  <div class="input-group input-group-sm">
                    <input
                      type="text"
                      class="form-control"
                      readonly
                      id="emailSubjectDetail"
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      data-copy-target="emailSubjectDetail"
                      title="Copy subject"
                    >
                      <i class="bi bi-clipboard"></i>
                    </button>
                  </div>
                </div>

                <div class="mb-2">
                  <label class="fw-bold small">Body:</label>
                  <div class="input-group input-group-sm">
                    <textarea
                      class="form-control"
                      readonly
                      rows="8"
                      id="emailBody"
                    ></textarea>
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      data-copy-target="emailBody"
                      title="Copy email body"
                    >
                      <i class="bi bi-clipboard"></i>
                    </button>
                  </div>
                </div>

                <div class="text-center mt-3">
                  <small class="text-muted">
                    Copy the content above and paste it into your email client
                  </small>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="bi bi-x-lg me-1"></i>Close
            </button>
            <div id="modalActions">
              <!-- Dynamic action buttons will be inserted here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      /* Additional styles for the inline status buttons */
      #requestDatesList .btn-group-sm .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
      }

      #requestDatesList .btn.active {
        font-weight: bold;
      }

      .date-row {
        border-bottom: 1px solid #dee2e6;
        padding: 0.75rem 0;
      }

      .date-row:last-child {
        border-bottom: none;
      }
    </style>

  </div>
</div>
