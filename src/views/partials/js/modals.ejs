<!-- src/views/partials/js/modals.ejs -->
<script>
  // Modern replacement for confirm() and alert()
  window.modernConfirm = function (
    message,
    title = 'Confirm Action',
    type = 'warning'
  ) {
    return new Promise((resolve) => {
      const modal = document.getElementById('confirmationModal');
      const modalContent = modal.querySelector('.modal-content');
      const titleElement = document.getElementById('confirmTitle');
      const messageElement = document.getElementById('confirmMessage');
      const iconElement = document.getElementById('confirmIcon');
      const confirmButton = document.getElementById('confirmAction');

      // ✅ FIX: Calculate proper z-index based on existing modals
      const existingModals = document.querySelectorAll('.modal.show');
      const baseZIndex = 1050; // Bootstrap modal base z-index
      const newZIndex = baseZIndex + existingModals.length * 10 + 10;

      // Apply z-index to modal
      modal.style.zIndex = newZIndex;

      // Reset modal styling
      modalContent.className = 'modal-content';

      // Set content
      titleElement.textContent = title;
      messageElement.textContent = message;

      // Configure for different types
      if (type === 'danger') {
        modalContent.classList.add('danger');
        iconElement.className =
          'bi bi-exclamation-triangle text-danger me-2 fs-4';
        confirmButton.className = 'btn btn-danger';
        confirmButton.innerHTML = '<i class="bi bi-trash me-1"></i>Delete';
      } else if (type === 'logout') {
        modalContent.classList.add('warning');
        iconElement.className = 'bi bi-box-arrow-right text-warning me-2 fs-4';
        confirmButton.className = 'btn btn-warning';
        confirmButton.innerHTML =
          '<i class="bi bi-box-arrow-right me-1"></i>Logout';
      } else {
        iconElement.className = 'bi bi-question-circle text-warning me-2 fs-4';
        confirmButton.className = 'btn btn-primary';
        confirmButton.innerHTML = '<i class="bi bi-check-lg me-1"></i>Confirm';
      }

      // ✅ FIX: Use backdrop: false to prevent conflicts with existing modals
      const bootstrapModal = new bootstrap.Modal(modal, {
        backdrop: 'static',
        keyboard: true,
      });

      // Show modal
      bootstrapModal.show();

      // ✅ FIX: Clean up event listeners to prevent memory leaks
      const handleConfirm = () => {
        bootstrapModal.hide();
        confirmButton.removeEventListener('click', handleConfirm);
        modal.removeEventListener('hidden.bs.modal', handleCancel);
        resolve(true);
      };

      const handleCancel = () => {
        confirmButton.removeEventListener('click', handleConfirm);
        modal.removeEventListener('hidden.bs.modal', handleCancel);
        resolve(false);
      };

      confirmButton.addEventListener('click', handleConfirm);
      modal.addEventListener('hidden.bs.modal', handleCancel, { once: true });
    });
  };

  window.modernAlert = function (
    message,
    title = 'Information',
    type = 'info'
  ) {
    return new Promise((resolve) => {
      const modal = document.getElementById('alertModal');
      const titleElement = document.getElementById('alertTitle');
      const messageElement = document.getElementById('alertMessage');
      const iconElement = document.getElementById('alertIcon');

      // Set content
      titleElement.textContent = title;
      messageElement.textContent = message;

      // Configure icon for different types
      if (type === 'error') {
        iconElement.className =
          'bi bi-exclamation-triangle text-danger me-2 fs-4';
      } else if (type === 'success') {
        iconElement.className = 'bi bi-check-circle text-success me-2 fs-4';
      } else {
        iconElement.className = 'bi bi-info-circle text-primary me-2 fs-4';
      }

      // Show modal
      const bootstrapModal = new bootstrap.Modal(modal);
      bootstrapModal.show();

      // Handle close
      modal.addEventListener('hidden.bs.modal', () => resolve(), {
        once: true,
      });
    });
  };
</script>
